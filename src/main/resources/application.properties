# ===============================
# APPLICATION
# ===============================
spring.application.name=enterprise-saas-backend
server.port=${PORT:8081}


# ===============================
# DATASOURCE (SUPABASE POSTGRES)
# ===============================
# Use the TRANSACTION POOLER URL from Supabase for best results on Render
spring.datasource.url=${DB_URL}
spring.datasource.username=${DB_USERNAME}
spring.datasource.password=${DB_PASSWORD}

# spring.datasource.url=jdbc:postgresql://aws-1-ap-northeast-1.pooler.supabase.com:6543/postgres
# spring.datasource.username=postgres.dlahqyyheawhuwephrmp
# spring.datasource.password=4exbqN-Xy.WvP!$



# ===============================
# JPA / HIBERNATE
# ===============================
# Explicitly set dialect as it's failing to auto-detect on Render
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect

# Map Jakarta persistence properties directly (sometimes required by newer Hibernate versions)
jakarta.persistence.jdbc.url=${DB_URL}
jakarta.persistence.jdbc.user=${DB_USERNAME}
jakarta.persistence.jdbc.password=${DB_PASSWORD}
jakarta.persistence.jdbc.driver=org.postgresql.Driver

spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=false
spring.jpa.open-in-view=false

spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.jdbc.lob.non_contextual_creation=true
# Fix for "transaction is aborted" when using Supabase Pooler
spring.datasource.hikari.data-source-properties.prepareThreshold=0
# Prevent Hibernate from trying to use temporary tables/metadata that might fail on poolers
spring.jpa.properties.hibernate.temp.use_jdbc_metadata_defaults=false


# ===============================
# TRANSACTIONS
# ===============================
spring.transaction.default-timeout=30


# ===============================
# SESSION MANAGEMENT (PRODUCTION)
# ===============================
# Allow cross-site cookies (Vercel -> Railway)
server.servlet.session.cookie.same-site=none
server.servlet.session.cookie.secure=true
# Handle proxy headers from Railway/Render
server.forward-headers-strategy=framework


# ===============================
# SECURITY (BASELINE)
# ===============================
spring.security.user.name=disabled
spring.security.user.password=disabled





# ===============================
# JACKSON (JSON HANDLING)
# ===============================
spring.jackson.default-property-inclusion=non_null
spring.jackson.time-zone=UTC


# ===============================
# ACTUATOR
# ===============================
management.endpoints.web.exposure.include=health,info
management.endpoint.health.show-details=never


# ===============================
# LOGGING
# ===============================
logging.level.root=INFO
logging.level.org.springframework.web=INFO
logging.level.org.hibernate.SQL=INFO
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=OFF


# ===============================
# ERROR HANDLING
# ===============================
server.error.include-message=never
server.error.include-binding-errors=never
server.error.include-stacktrace=never
server.error.include-exception=false
